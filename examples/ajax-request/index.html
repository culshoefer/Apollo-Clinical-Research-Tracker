<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JSON Loading Example</title>
</head>
<body>

    <!-- A bit of CSS styling -->
    <style>

        #target {
            background-color: #a9e2b5;
        }

    </style>

    <!-- Buttons that will load the content -->
    <button id="load-success" class="test">Load an existing file without errors</button>
    <button id="load-error">Load an existing file with an error specified</button>
    <button id="load-failure">Try to load a non-existent file</button>

    <!-- Target HTML container to load the data too -->
    <div id="target">

        <!-- DATA GOES HERE -->

    </div>

    <!-- JS log goes here -->
    <pre id="log"></pre>

    <!-- jQuery to save use some time -->
    <script src="http://code.jquery.com/jquery-2.2.0.min.js"></script>


    <!-- JS code to make the AJAX request and load the data into the page -->
    <script>

        $(document).ready(function() {

            $('body').on('click', 'button', function(e) {

                e.preventDefault();
                var that = $(this);
                var id = that.attr('id').substr(5);

                $('#target').html('');
                log(false);
                log('User clicked on \'' + id + '\' button.');

                switch(id) {
                    case 'success':
                        load('data.json');
                        break;
                    case 'error':
                        load('error.json');
                        break;
                    case 'failure':
                        load('non-existent-file.jsonw');
                        break;
                }

            });

            function load(url) {
                log('Function \'load\' has been called on \'' + url + '\'.');

                var postData = {
                    auth_token: 'The Token Goes Here',
                    // Other data
                };

                var responseData = loadData(url, postData);

                if(responseData === null) {
                    log('A server error has occured!');
                    return;
                }

                if(responseData.error != null) {
                    log('An application error has occured!');
                    log('Error ID: ' + responseData.error.id);
                    log('Error description: ' + responseData.error.description);
                    return;
                }

                var target = $('#target');
                var html = '<h1>' + responseData.data.firstname + ' ' + responseData.data.surname + '</h1>';
                html += '<h2>' + responseData.data.email + ', ' + responseData.data.phone + '</h2>';
                target.html(html);
            }

            function loadData(url, data) {

                var response = null;

                log('Making an AJAX request to \'' + url +'\'...');

                $.ajax({
                    url: url,
                    type: 'GET',
                    async: false,
                    cache: false,
                    timeout: 30000,
                    dataType: 'html',
                    error: function() {
                        log('AJAX request failed!');
                    },
                    success: function(responseData) {
                        log('AJAX request successful.');
                        response = $.parseJSON(responseData);
                    }
                });

                return response;

            }

            function log(message) {
                var log = $('#log');
                if(message === false) {
                    log.html(null);
                    return;
                }

                log.html(log.html() + '<br>' + message)
            }

        });

    </script>

</body>
</html>
